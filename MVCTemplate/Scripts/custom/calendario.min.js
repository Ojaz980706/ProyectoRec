var inactivityTime=function(){function n(){clearTimeout(t);t=setTimeout(Calendar.rebuild,3e4)}var t;window.onload=n;document.onmousemove=n;document.onkeypress=n};(function(n){"use strict";n(document).ready(function(){function i(i){var f,u,r;for(n("#eventIndex").val(),n("#txtEventName").val(),n("#Folio").val(),n("#txtEspecialidad").val(),n("#lblNombre").val(),n("#lblNoEmpleado").val(),n("#lblDivision").val(),n("#lblTurno").val(),n("#lblComentarios").val(),n("#ltBitacora").text(""),n("#eventSave").attr("hidden",!1),n("#eventAssisted").attr("hidden",!1),n("#eventUnassisted").attr("hidden",!1),n("#eventCanceled").attr("hidden",!1),n("input[type=radio]:not(:checked)").parent("div").attr("hidden",!1),n("#lblBaja").attr("hidden",!0),n("#event-date").html(moment(i.start).format("D MMMM YYYY")),n("#lblfromTime").html(moment(i.start).format("h:mm A")),n("#lbltoTime").html(moment(i.end).format("h:mm A")),n("#eventIndex").val(i.index),n("#txtEventName").val(i.title),n("#txtFolio").val(i.other.folio),n("#txtEspecialidad").val(i.other.especialidad),n("#lblNombre").html(i.other.nombre),n("#lblNoEmpleado").html(i.other.numeroempleado),n("#lblPacienteNombre").html(i.other.paciente.InformacionPersonal.NombreApellido),n("#lblPacienteParentesco").html(i.other.paciente.Parentesco.Definicion),n("#lblMotivo").html(i.other.motivo.MotivoEspecialidad),n("#lblDivision").html(i.other.division),n("#lblTurno").html(i.other.turno).attr("title",i.other.turno),n("#lblComentarios").html(i.other.comentarios),n("#lblEstadoActual").html(i.other.bitacora[i.other.bitacora.length-1].Estado.Detalle),n("#lnkReporte").attr("href",mainUrl+"Citas/CitaConfirmedReport/"+i.other.folio),n("#lnkBorrar").attr("href",mainUrl+"Citas/Delete/"+i.other.folio),n("#lnkTratamientos").attr("href",mainUrl+"Tratamientos/TratamientoCita/"+i.other.folio),i.other.TieneEntrevista?(n("#lnkHistorial").css("display","block"),n("#lnkHistorial").attr("href",mainUrl+"Entrevistas/Create/"+i.other.folio),n("#lnkNotas").parent().css("display","block"),n("#lnkNotas").attr("href",mainUrl+"notas/create/?PacienteId="+i.other.paciente.PacienteId+"&CitaId="+i.other.folio)):(n("#lnkHistorial").css("display","block"),n("#lnkHistorial").attr("href",mainUrl+"Entrevistas/Create/"+i.other.folio),n("#lnkNotas").parent().css("display","none")),f=n.ajax({url:mainUrl+"Usuarios/ImagenDelEmpleado/"+i.other.numeroempleado,type:"GET",async:!0,success:function(){},error:function(n){console.log("ERROR");console.log(n)}}),f.done(function(t){n("#imgEmpleado").attr("src","data:image/gif;base64,"+t)}),u=i.other.bitacora[i.other.bitacora.length-1].EstadoId,r=0;r<i.other.bitacora.length;r++)n("#ltBitacora").append('<li class="p-l-5 p-t-5 font-montserrat"> '+i.other.bitacora[r].Estado.Detalle+' <span class="small-text hint-text"> '+moment(i.other.bitacora[r].FechaModificado).format("YYYY/MM/DD hh:mm A")+" <\/span> <\/li>");(i.readOnly||u>=3)&&(n("#eventSave").attr("hidden",!0),n("#eventAssisted").attr("hidden",!0),n("#eventUnassisted").attr("hidden",!0),n("#eventCanceled").attr("hidden",!0));u===7&&(n("[data-index="+i.index+"]").addClass("bg-danger"),n("#lblBaja").attr("hidden",!1));t=i}var t;n.ajax({type:"GET",url:mainUrl+"Calendario/getEvents",data:{MedicoId:getUrlParameter("MedicoId")},success:function(r){n("#myCalendar").pagescalendar({events:JSON.parse(r),slotDuration:15,onViewRenderComplete:function(t){var i=t.start.format(),r=t.end.format();n("body").hasClass("pending")||(n("body").addClass("pending"),n("body").removeClass("pending"),n.ajax({url:mainUrl+"Medicos/GetInfo/"+getUrlParameter("MedicoId"),type:"GET",async:!0,success:function(t){var i=JSON.parse(t);i.Especialidad.NombreEspecialidad.toLowerCase().indexOf("2do turno")==-1?(n("#weekGrid").children("div:lt(6)").toggle(),n("#time-slots").children("div:lt(6)").toggle(),n("#time-slots").children("div").slice(-4).toggle(),n("#weekGrid").children("div").slice(-4).toggle()):n("#lnkHorasInactivas").text("Ocultar horas inactivas")},error:function(n){console.log(n)}}))},onEventClick:function(r){n("#calendar-event").hasClass("open")||n("#calendar-event").addClass("open");n.ajax({type:"GET",url:mainUrl+"Calendario/GetEventoDetalle",data:"id="+r.other.folio,success:function(n){r.other=JSON.parse(n);t=r;i(t)},error:function(t){n("#myCalendar").pagescalendar("error",t.status+": Something horribly went wrong :(");n("body").removeClass("pending")}})},onEventDragComplete:function(r){n.ajax({type:"GET",url:mainUrl+"Calendario/GetEventoDetalle",data:"id="+r.other.folio,success:function(n){r.other=JSON.parse(n);t=r;i(t)},error:function(t){n("#myCalendar").pagescalendar("error",t.status+": Something horribly went wrong :(");n("body").removeClass("pending")}})},onEventResizeComplete:function(r){n.ajax({type:"GET",url:mainUrl+"Calendario/GetEventoDetalle",data:"id="+r.other.folio,success:function(n){r.other=JSON.parse(n);t=r;i(t)},error:function(t){n("#myCalendar").pagescalendar("error",t.status+": Something horribly went wrong :(");n("body").removeClass("pending")}})}})},error:function(t){n("#myCalendar").pagescalendar("error",t.status+": Something horribly went wrong :(");n("body").removeClass("pending")}});n("#eventSave").on("click",function(){(console.log(t),n("body").hasClass("pending"))||(n("body").addClass("pending"),n.ajax({type:"POST",url:mainUrl+"Calendario/UpdateEvent",data:{jsonEvento:JSON.stringify(t),estado:null},success:function(i){if(console.log(i),i.success)i.notify&&(notify(i.style,i.title,i.message,i.position,i.time,i.type,i.icono,i.where),t=JSON.parse(i.evento),n("#myCalendar").pagescalendar("updateEvent",t),n("body").removeClass("pending"));else{n("#myCalendar").pagescalendar("error",ajaxContext.status+": Something horribly went wrong :(");n("body").removeClass("pending");return}},error:function(t){n("#myCalendar").pagescalendar("error",t.status+": Something horribly went wrong :(");n("body").removeClass("pending")}}),n("#myCalendar").pagescalendar("rebuild"),n("#calendar-event").removeClass("open"))});n("#eventAssisted").on("click",function(){(console.log(t),n("body").hasClass("pending"))||(n("body").addClass("pending"),n.ajax({type:"POST",url:mainUrl+"Calendario/UpdateEvent",data:{jsonEvento:JSON.stringify(t),estado:3},success:function(i){if(console.log(i),i.success)i.notify&&(notify(i.style,i.title,i.message,i.position,i.time,i.type,i.icono,i.where),t=JSON.parse(i.evento),n("#myCalendar").pagescalendar("updateEvent",t),n("body").removeClass("pending"));else{n("#myCalendar").pagescalendar("error",ajaxContext.status+": Something horribly went wrong :(");n("body").removeClass("pending");return}},error:function(t){n("#myCalendar").pagescalendar("error",t.status+": Something horribly went wrong :(");n("body").removeClass("pending")}}),n("#myCalendar").pagescalendar("rebuild"),n("#calendar-event").removeClass("open"))});n("#eventUnassisted").on("click",function(){(console.log(t),n("body").hasClass("pending"))||(n("body").addClass("pending"),n.ajax({type:"POST",url:mainUrl+"Calendario/UpdateEvent",data:{jsonEvento:JSON.stringify(t),estado:4},success:function(i){if(console.log(i),i.success)i.notify&&(notify(i.style,i.title,i.message,i.position,i.time,i.type,i.icono,i.where),t=JSON.parse(i.evento),n("#myCalendar").pagescalendar("updateEvent",t),n("body").removeClass("pending"));else{n("#myCalendar").pagescalendar("error",ajaxContext.status+": Something horribly went wrong :(");n("body").removeClass("pending");return}},error:function(t){n("#myCalendar").pagescalendar("error",t.status+": Something horribly went wrong :(");n("body").removeClass("pending")}}),n("#myCalendar").pagescalendar("rebuild"),n("#calendar-event").removeClass("open"))});n("#eventCanceled").on("click",function(){(console.log(t),n("body").hasClass("pending"))||(n("body").addClass("pending"),n.ajax({type:"POST",url:mainUrl+"Calendario/UpdateEvent",data:{jsonEvento:JSON.stringify(t),estado:5},success:function(i){if(console.log(i),i.success)i.notify&&(notify(i.style,i.title,i.message,i.position,i.time,i.type,i.icono,i.where),t=JSON.parse(i.evento),n("#myCalendar").pagescalendar("updateEvent",t),n("body").removeClass("pending"));else{n("#myCalendar").pagescalendar("error",ajaxContext.status+": Something horribly went wrong :(");n("body").removeClass("pending");return}},error:function(t){n("#myCalendar").pagescalendar("error",t.status+": Something horribly went wrong :(");n("body").removeClass("pending")}}),n("#myCalendar").pagescalendar("rebuild"),n("#calendar-event").removeClass("open"))});n("#eventDelete").on("click",function(){n("#myCalendar").pagescalendar("removeEvent",n("#eventIndex").val());n("#calendar-event").removeClass("open")})})})(window.jQuery);